# Web 界面测试指南

本文档提供详细的测试步骤，帮助您验证 Web 界面的各项功能。

## 🧪 测试前准备

### 1. 确认依赖已安装

```bash
pip list | findstr "fastapi uvicorn langgraph"
```

应该看到：
- fastapi >= 0.115.0
- uvicorn >= 0.32.0
- langgraph >= 0.2.61

### 2. 确认配置正确

检查 `.env` 文件：
- ✅ GITEE_AI_API_KEY 已填写
- ✅ GITEE_AI_BASE_URL 正确
- ✅ GITEE_AI_MODEL 已设置

### 3. 启动服务

```bash
python run_web.py
```

确认看到启动成功的提示信息。

## 📝 功能测试清单

### ✅ 测试 1：页面加载

1. 打开浏览器，访问 http://localhost:8000
2. **预期结果：**
   - 页面正常加载
   - 显示紫色渐变的标题栏
   - 显示 "🤖 ShuYixiao Agent" 标题
   - 右上角显示绿色"在线"状态指示器
   - 显示"开始对话"的空状态提示

### ✅ 测试 2：简单对话模式

1. 确保 Agent 类型选择为"简单对话"
2. 在输入框输入："你好"
3. 点击"发送"按钮
4. **预期结果：**
   - 用户消息显示在右侧（紫色气泡）
   - 等待 2-5 秒后出现 AI 回复
   - AI 回复显示在左侧（白色气泡）
   - 回复内容友好且相关
   - 页面自动滚动到最新消息

### ✅ 测试 3：工具调用模式

1. 切换 Agent 类型为"工具调用"
2. 测试获取时间：
   - 输入："现在几点了？"
   - **预期结果：** 返回当前时间
   
3. 测试计算功能：
   - 输入："帮我计算 123 * 456"
   - **预期结果：** 返回计算结果 56088

4. 测试搜索功能：
   - 输入："搜索维基百科关于 Python 的信息"
   - **预期结果：** 返回模拟的搜索结果

### ✅ 测试 4：多轮对话

1. 依次输入以下问题（简单对话模式）：
   ```
   第1轮: "我叫小明"
   第2轮: "我刚才说我叫什么名字？"
   ```
2. **预期结果：**
   - AI 应该能记住之前的对话
   - 正确回答"小明"

### ✅ 测试 5：清除历史

1. 发送几条消息
2. 点击顶部"清除历史"按钮
3. 在确认对话框点击"确定"
4. **预期结果：**
   - 所有消息被清除
   - 显示"开始对话"空状态
   - 刷新页面后历史仍然为空

### ✅ 测试 6：历史记录持久化

1. 发送几条消息
2. 刷新浏览器页面（F5）
3. **预期结果：**
   - 之前的对话历史全部显示
   - 可以继续对话

### ✅ 测试 7：输入框功能

1. 测试多行输入：
   - 按 Shift + Enter 换行
   - **预期结果：** 输入框高度自动增长
   
2. 测试 Enter 发送：
   - 输入文本后按 Enter
   - **预期结果：** 消息被发送
   
3. 测试空消息：
   - 不输入任何文字，点击发送
   - **预期结果：** 不发送消息，没有任何反应

### ✅ 测试 8：加载状态

1. 发送一条消息
2. 观察发送按钮
3. **预期结果：**
   - 按钮变为禁用状态
   - 显示旋转的加载动画
   - 收到回复后恢复正常

### ✅ 测试 9：错误处理

1. 测试无效的 API Key：
   - 停止服务
   - 修改 `.env` 中的 API Key 为无效值
   - 重启服务并发送消息
   - **预期结果：** 显示错误提示（红色背景）

2. 测试网络错误：
   - 在浏览器开发者工具中模拟离线
   - 发送消息
   - **预期结果：** 显示网络错误提示

### ✅ 测试 10：响应式设计

1. 调整浏览器窗口大小
2. **预期结果：**
   - 布局自适应
   - 在窄屏下内容仍然可读
   - 消息气泡宽度适当调整

## 🔍 API 测试

### 测试 API 健康检查

```bash
curl http://localhost:8000/api/health
```

**预期响应：**
```json
{
    "status": "healthy",
    "api_key_configured": true,
    "model": "DeepSeek-V3"
}
```

### 测试聊天 API

```bash
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d "{\"message\": \"你好\", \"agent_type\": \"simple\", \"session_id\": \"test\"}"
```

**预期响应：**
```json
{
    "response": "你好！有什么可以帮助你的吗？",
    "agent_type": "simple",
    "session_id": "test"
}
```

### 测试历史记录 API

```bash
# 获取历史
curl http://localhost:8000/api/history/test

# 清除历史
curl -X DELETE http://localhost:8000/api/history/test
```

## 🐛 常见问题排查

### 问题 1：页面显示 "无法连接到服务器"

**排查步骤：**
1. 检查后端服务是否运行
2. 检查端口 8000 是否被占用
3. 查看控制台错误日志
4. 尝试访问 http://localhost:8000/api/health

### 问题 2：发送消息后无响应

**排查步骤：**
1. 打开浏览器开发者工具（F12）
2. 查看 Console 标签页的错误
3. 查看 Network 标签页的请求
4. 检查后端控制台的日志

### 问题 3：工具调用不工作

**排查步骤：**
1. 确认选择了"工具调用"模式
2. 检查问题是否明确需要工具
3. 查看后端日志中的工具调用信息

## ✅ 测试报告模板

```
测试日期：____________________
测试人员：____________________

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 页面加载 | ☐ 通过 ☐ 失败 | |
| 简单对话 | ☐ 通过 ☐ 失败 | |
| 工具调用 | ☐ 通过 ☐ 失败 | |
| 多轮对话 | ☐ 通过 ☐ 失败 | |
| 清除历史 | ☐ 通过 ☐ 失败 | |
| 历史持久化 | ☐ 通过 ☐ 失败 | |
| 输入框功能 | ☐ 通过 ☐ 失败 | |
| 加载状态 | ☐ 通过 ☐ 失败 | |
| 错误处理 | ☐ 通过 ☐ 失败 | |
| 响应式设计 | ☐ 通过 ☐ 失败 | |

总体评价：____________________
```

## 🎯 性能测试（可选）

### 测试响应时间

使用 Python 脚本测试：

```python
import time
import requests

url = "http://localhost:8000/api/chat"
data = {
    "message": "你好",
    "agent_type": "simple",
    "session_id": "perf_test"
}

# 测试 10 次
times = []
for i in range(10):
    start = time.time()
    response = requests.post(url, json=data)
    end = time.time()
    times.append(end - start)
    print(f"第 {i+1} 次: {end - start:.2f} 秒")

print(f"\n平均响应时间: {sum(times) / len(times):.2f} 秒")
print(f"最快: {min(times):.2f} 秒")
print(f"最慢: {max(times):.2f} 秒")
```

**预期结果：**
- 平均响应时间 < 5 秒
- 没有超时错误

## 📊 浏览器兼容性测试

测试以下浏览器：
- ☐ Chrome (推荐)
- ☐ Edge
- ☐ Firefox
- ☐ Safari

所有现代浏览器都应该正常工作。

---

**测试完成后，您就可以放心使用 Web 界面了！** ✨

