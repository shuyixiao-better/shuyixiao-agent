# 📄 知识库文档管理功能使用指南

## 🎉 新功能介绍

现在你可以在 Web 界面中**查看**和**删除**知识库中的文档了！

### ✨ 功能特性

1. **📋 文档列表浏览** - 查看知识库中所有文档
2. **👁️ 文档详情查看** - 查看完整文档内容和元数据
3. **🗑️ 单个文档删除** - 精确删除不需要的文档
4. **📊 实时统计** - 显示文档总数和当前显示数量
5. **🔄 一键刷新** - 快速更新文档列表

---

## 🚀 使用方法

### 1. 启动 Web 服务器

```bash
cd /Users/shuyixiao/PycharmProjects/shuyixiao-agent
python run_web.py
```

访问：http://localhost:8000

### 2. 进入知识库管理页面

点击顶部的 **🗄️ 知识库管理** 标签页。

### 3. 使用文档浏览器

#### 📝 步骤 1：选择知识库

在 **"文档浏览器"** 卡片中，输入要查看的知识库名称（如 `default`）。

#### 📝 步骤 2：加载文档列表

点击 **"加载文档列表"** 按钮。

#### 📝 步骤 3：浏览文档

系统会显示：
- **知识库名称**
- **总文档数**
- **当前显示的文档数**

每个文档显示：
- 文档 ID
- 文档内容预览（前 100 个字符）
- 操作按钮（查看/删除）

---

## 📖 功能详解

### 🔍 查看文档详情

1. 在文档列表中找到要查看的文档
2. 点击 **"查看"** 按钮
3. 弹出模态框显示：
   - 完整文档 ID
   - 完整文档内容
   - 文档元数据（如果有）

4. 可以在模态框中：
   - 查看完整内容
   - 点击 **"删除文档"** 直接删除
   - 点击 **"关闭"** 或背景关闭模态框

### 🗑️ 删除文档

#### 方式 1：从列表删除
1. 在文档列表中找到要删除的文档
2. 点击 **"删除"** 按钮
3. 确认删除
4. 文档列表自动刷新

#### 方式 2：从详情页删除
1. 点击文档的 **"查看"** 按钮
2. 在模态框中点击 **"删除文档"** 按钮
3. 确认删除
4. 模态框自动关闭，列表自动刷新

### 🔄 刷新列表

随时点击 **"刷新"** 按钮更新文档列表。

---

## 🎨 界面预览

### 文档浏览器布局

```
┌─────────────────────────────────────────────────┐
│ 📄 文档浏览器                                    │
├─────────────────────────────────────────────────┤
│ 查看知识库： [default          ]                │
│ [加载文档列表]  [刷新]                          │
├─────────────────────────────────────────────────┤
│ 知识库：default | 总文档数：6 | 显示：6 / 6     │
├─────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────┐ │
│ │ ID: abc123                                  │ │
│ │ 你好，我是舒一笑不秃头...    [查看] [删除]  │ │
│ ├─────────────────────────────────────────────┤ │
│ │ ID: def456                                  │ │
│ │ IDEA插件-PandaCoder...       [查看] [删除]  │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

### 文档详情模态框

```
┌──────────────────────────────────────┐
│ 📄 文档详情                    × │
├──────────────────────────────────────┤
│                                      │
│ ID: abc123                           │
│                                      │
│ 你好，我是舒一笑不秃头，          │
│ 一名资深Java开发工程师和          │
│ 技术博主。                         │
│                                      │
│ ─────────────────────────────────   │
│ 元数据：                            │
│ {                                    │
│   "source": "user_upload",           │
│   "timestamp": "2024-10-12"          │
│ }                                    │
│                                      │
├──────────────────────────────────────┤
│              [关闭]  [删除文档]      │
└──────────────────────────────────────┘
```

---

## 🔐 API 接口说明

### 后端新增的 API 端点

#### 1. 获取文档列表
```
GET /api/rag/documents/{collection_name}?limit=50&offset=0
```

**响应示例：**
```json
{
  "collection_name": "default",
  "total_count": 100,
  "documents": [
    {
      "id": "doc_abc123",
      "text": "文档内容...",
      "metadata": {"source": "upload"}
    }
  ],
  "count": 50
}
```

#### 2. 获取单个文档
```
GET /api/rag/document/{collection_name}/{doc_id}
```

**响应示例：**
```json
{
  "collection_name": "default",
  "document": {
    "id": "doc_abc123",
    "text": "完整文档内容...",
    "metadata": {"source": "upload"}
  }
}
```

#### 3. 删除文档
```
DELETE /api/rag/document/{collection_name}/{doc_id}
```

**响应示例：**
```json
{
  "message": "文档已删除",
  "collection_name": "default",
  "document_id": "doc_abc123",
  "remaining_count": 99
}
```

---

## 💡 使用技巧

### 1. 批量查看
- 默认显示前 50 个文档
- 如需查看更多，可修改 `loadDocuments()` 的 `limit` 参数

### 2. 快速定位
- 文档按添加顺序显示
- 使用浏览器的查找功能（Ctrl+F / Cmd+F）快速搜索文档内容

### 3. 安全删除
- 所有删除操作都需要确认
- 删除后无法恢复，请谨慎操作
- 建议在删除前先查看文档详情确认

### 4. 知识库切换
- 可以随时切换不同的知识库名称
- 支持中文知识库名称（自动转换为合法名称）

---

## 🔧 故障排除

### 问题 1：文档列表为空

**可能原因：**
- 知识库名称不存在
- 知识库确实没有文档

**解决方法：**
1. 检查知识库名称是否正确
2. 先上传一些文档
3. 查看 "知识库信息" 确认文档数量

### 问题 2：无法删除文档

**可能原因：**
- 文档 ID 不存在
- 网络连接问题

**解决方法：**
1. 刷新文档列表
2. 检查浏览器控制台错误信息
3. 查看后端日志

### 问题 3：模态框无法关闭

**解决方法：**
- 点击模态框外的灰色区域
- 点击右上角的 × 按钮
- 点击 "关闭" 按钮
- 按 ESC 键（需要添加支持）

---

## 📊 性能说明

### 文档加载性能

| 文档数量 | 加载时间 | 建议 |
|---------|---------|------|
| < 50 | < 1秒 | ✅ 快速 |
| 50-200 | 1-3秒 | ✅ 正常 |
| 200-500 | 3-5秒 | ⚠️ 较慢，考虑分页 |
| > 500 | > 5秒 | ❌ 建议实现分页 |

### 优化建议

如果文档数量很大（>500），建议：
1. 实现分页功能
2. 添加搜索/过滤功能
3. 只加载最近的文档

---

## 🎯 未来功能计划

- [ ] **分页浏览** - 大量文档的分页显示
- [ ] **搜索过滤** - 按内容搜索文档
- [ ] **批量删除** - 选择多个文档批量删除
- [ ] **导出功能** - 导出文档为文件
- [ ] **编辑功能** - 在线编辑文档内容
- [ ] **标签管理** - 为文档添加标签
- [ ] **排序功能** - 按时间、长度等排序

---

## 📝 代码示例

### Python 代码调用示例

```python
from shuyixiao_agent.rag.rag_agent import RAGAgent

# 创建 RAG Agent
agent = RAGAgent(collection_name="default")

# 列出所有文档
documents = agent.list_documents(limit=10)
for doc in documents:
    print(f"ID: {doc['id']}")
    print(f"内容: {doc['text'][:50]}...")
    print("---")

# 获取单个文档
doc = agent.get_document_by_id("doc_abc123")
if doc:
    print(f"完整内容: {doc['text']}")
    print(f"元数据: {doc['metadata']}")

# 删除文档
success = agent.delete_document("doc_abc123")
if success:
    print("文档已删除")
```

---

## 🙏 反馈与建议

如果在使用过程中遇到问题或有改进建议，欢迎反馈！

**联系方式：**
- 作者：舒一笑不秃头
- 博客：阿里云博客专家

---

## 📚 相关文档

- [RAG 存储位置说明](RAG_STORAGE_GUIDE.md)
- [快速开始指南](QUICK_START.md)
- [项目概述](docs/PROJECT_OVERVIEW.md)

---

**祝使用愉快！** 🎉

