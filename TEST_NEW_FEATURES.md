# 新功能测试指南

## 🎯 快速测试步骤

### 准备工作

1. **更新代码**（已完成）
2. **重启服务**（必须）

```bash
# 如果服务正在运行，先停止（Ctrl+C）
# 然后重新启动
python run_web.py
```

3. **清除浏览器缓存**（推荐）
   - 按 `Ctrl + Shift + Delete`
   - 或强制刷新：`Ctrl + F5`

## ✅ 功能 1：Markdown 渲染测试

### 测试 1.1 - 代码块渲染

1. 打开 http://localhost:8000
2. 选择 "简单对话" 模式
3. 输入：
   ```
   用 Python 写一个快速排序算法，用 Markdown 格式返回
   ```

**预期结果：**
- ✅ 代码块有深色背景
- ✅ 代码有正确的缩进
- ✅ 代码是等宽字体
- ✅ 代码块可以水平滚动（如果很长）

### 测试 1.2 - 标题和列表

输入：
```
用 Markdown 格式列出 Python 的 5 个主要特点，包括标题、列表和重点标记
```

**预期结果：**
- ✅ 标题有正确的大小
- ✅ 列表有正确的缩进
- ✅ 粗体/斜体正确显示
- ✅ 整体排版美观

### 测试 1.3 - 表格渲染

输入：
```
用 Markdown 表格格式比较 Python、Java 和 JavaScript 的特点
```

**预期结果：**
- ✅ 表格有清晰的边框
- ✅ 表头有背景色
- ✅ 单元格对齐正确
- ✅ 表格不会超出消息气泡

### 测试 1.4 - 混合内容

输入：
```
介绍一下 FastAPI 框架，包括：
1. 什么是 FastAPI（标题）
2. 主要特点（列表）
3. 简单示例（代码块）
4. 与其他框架对比（表格）

请用完整的 Markdown 格式
```

**预期结果：**
- ✅ 所有 Markdown 元素正确渲染
- ✅ 排版美观
- ✅ 滚动流畅
- ✅ 代码高亮清晰

### 测试 1.5 - 行内代码

输入：
```
解释 Python 中的 `print()` 函数，包括参数说明
```

**预期结果：**
- ✅ `print()` 显示为行内代码样式
- ✅ 有浅色背景
- ✅ 与普通文字区分明显

## ✅ 功能 2：清空历史测试

### 测试 2.1 - 基本清空功能

1. 发送 3-5 条消息建立对话历史
2. 点击顶部的 "清除历史" 按钮
3. 在确认对话框中点击 "确定"

**预期结果：**
- ✅ 所有消息立即消失
- ✅ 显示 "开始对话" 的空状态
- ✅ 没有错误提示

### 测试 2.2 - 取消清空

1. 发送几条消息
2. 点击 "清除历史" 按钮
3. 在确认对话框中点击 "取消"

**预期结果：**
- ✅ 消息保持不变
- ✅ 没有任何变化

### 测试 2.3 - 清空后发送新消息

1. 清除历史
2. 发送一条新消息

**预期结果：**
- ✅ 空状态消失
- ✅ 显示新消息和回复
- ✅ 开始新的对话

### 测试 2.4 - 刷新页面验证

1. 清除历史
2. 刷新浏览器（F5）

**预期结果：**
- ✅ 页面加载后仍然是空状态
- ✅ 历史确实被清除（不是只清除了显示）

### 测试 2.5 - 开发者工具检查

1. 按 F12 打开开发者工具
2. 切换到 "Console" 标签
3. 点击 "清除历史"
4. 观察控制台输出

**预期日志：**
```
开始清除历史...
清除历史响应状态: 200
清除历史成功: {message: "历史已清除", session_id: "default"}
历史已清除
```

5. 切换到 "Network" 标签
6. 点击 "清除历史"
7. 查看 DELETE 请求

**预期结果：**
- ✅ 看到 `DELETE /api/history/default` 请求
- ✅ 状态码：200
- ✅ 响应内容正确

## 🔍 调试检查清单

如果功能不正常，检查以下项：

### Markdown 渲染问题

□ 浏览器控制台有错误吗？（F12 → Console）  
□ marked.js 和 DOMPurify 库加载成功了吗？  
□ 在控制台输入 `typeof marked` 返回 "function" 吗？  
□ 在控制台输入 `typeof DOMPurify` 返回 "object" 吗？  
□ 是否强制刷新了浏览器缓存？（Ctrl + F5）

### 清空历史问题

□ 后端服务是否重启了？  
□ 浏览器控制台有错误吗？  
□ Network 标签中 DELETE 请求成功了吗？  
□ 控制台日志显示什么？  
□ 后端日志显示什么？

## 🎨 视觉效果验证

### Markdown 渲染效果

打开页面后，发送这个测试消息：

```
请用 Markdown 格式返回以下内容：

# 一级标题
## 二级标题
### 三级标题

**这是粗体** 和 *这是斜体*

- 无序列表项 1
- 无序列表项 2
  - 子项 2.1
  - 子项 2.2

1. 有序列表项 1
2. 有序列表项 2

`这是行内代码`

```python
def hello():
    print("Hello, World!")
```

| 列1 | 列2 | 列3 |
|-----|-----|-----|
| A   | B   | C   |
| 1   | 2   | 3   |

> 这是一个引用

---

[这是一个链接](https://example.com)
```

**检查以下效果：**

1. **标题**
   - [ ] 一级标题最大
   - [ ] 二级、三级依次变小
   - [ ] 加粗显示

2. **文字样式**
   - [ ] **粗体** 正确加粗
   - [ ] *斜体* 正确倾斜

3. **列表**
   - [ ] 无序列表有项目符号
   - [ ] 有序列表有数字
   - [ ] 缩进正确

4. **代码**
   - [ ] 行内代码有浅色背景
   - [ ] 代码块有深色背景
   - [ ] 代码等宽字体

5. **表格**
   - [ ] 有清晰边框
   - [ ] 表头有背景色
   - [ ] 内容对齐

6. **其他**
   - [ ] 引用有左侧边框
   - [ ] 分隔线显示
   - [ ] 链接是蓝色

## 📊 性能测试（可选）

### 测试渲染速度

1. 发送一条包含大量 Markdown 的消息
2. 观察渲染速度

**预期：**
- ✅ 立即渲染（< 100ms）
- ✅ 没有明显延迟
- ✅ 页面不卡顿

### 测试多次清空

1. 连续清空历史 5 次
2. 观察是否有问题

**预期：**
- ✅ 每次都成功
- ✅ 没有错误
- ✅ 性能正常

## ✅ 完整测试场景

### 场景 1：完整对话流程

1. 打开页面
2. 发送："你好"
3. 等待回复
4. 发送："用 Markdown 格式介绍 Python"
5. 检查 Markdown 渲染
6. 发送更多消息
7. 清空历史
8. 开始新对话

### 场景 2：切换 Agent 类型

1. 简单对话模式，发送几条消息
2. 切换到工具调用模式
3. 发送："现在几点？"
4. 检查工具调用结果
5. 清空历史
6. 验证两种模式都正常

## 📝 测试报告模板

```
测试时间：____________________
浏览器：____________________

Markdown 渲染测试：
- 代码块：□ 通过 □ 失败
- 标题列表：□ 通过 □ 失败
- 表格：□ 通过 □ 失败
- 混合内容：□ 通过 □ 失败
- 行内代码：□ 通过 □ 失败

清空历史测试：
- 基本清空：□ 通过 □ 失败
- 取消清空：□ 通过 □ 失败
- 清空后发送：□ 通过 □ 失败
- 刷新验证：□ 通过 □ 失败
- 开发者工具：□ 通过 □ 失败

问题记录：
____________________
____________________
____________________
```

## 🎉 测试通过标准

所有测试通过后，您应该能够：

- ✅ 看到美观的 Markdown 渲染
- ✅ 代码块有深色背景和高亮
- ✅ 表格显示清晰
- ✅ 清空历史立即生效
- ✅ 控制台没有错误
- ✅ 整体体验流畅

---

**准备好了吗？开始测试吧！** 🚀

如有任何问题，请查看控制台日志或联系开发者。

