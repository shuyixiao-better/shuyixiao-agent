# ğŸ”— Prompt Chaining Agent - å¿«é€Ÿå¼€å§‹

åŸºäº [Agentic Design Patterns](https://github.com/ginobefun/agentic-design-patterns-cn) ä¸­çš„ Prompt Chaining æ¨¡å¼å®ç°çš„æ™ºèƒ½ä»£ç†ã€‚

## âš¡ 5åˆ†é’Ÿå¿«é€Ÿä½“éªŒ

### 1. æœ€ç®€å•çš„æ–¹å¼ - è¿è¡Œç¤ºä¾‹

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/shuyixiao/PycharmProjects/shuyixiao-agent

# ç¡®ä¿ä¾èµ–å·²å®‰è£…
poetry install

# è¿è¡Œç®€å•ç¤ºä¾‹ï¼ˆ3ä¸ªåœºæ™¯ï¼‰
python examples/11_prompt_chaining_simple.py
```

é€‰æ‹©ä¸€ä¸ªç¤ºä¾‹ä½“éªŒï¼š
- **ç¤ºä¾‹1**: ç¿»è¯‘æ”¹è¿›é“¾ - æ¼”ç¤ºåŸºç¡€çš„é“¾å¼å¤„ç†
- **ç¤ºä¾‹2**: åšå®¢æ–‡ç« ç”Ÿæˆé“¾ - ä»æ ‡é¢˜åˆ°å®Œæ•´æ–‡ç« 
- **ç¤ºä¾‹3**: é—®é¢˜è§£å†³é“¾ - ç³»ç»ŸåŒ–çš„é—®é¢˜åˆ†æ

### 2. å®Œæ•´åŠŸèƒ½ä½“éªŒ

```bash
# è¿è¡Œå®Œæ•´æ¼”ç¤ºï¼ˆ5ä¸ªå®ç”¨åœºæ™¯ï¼‰
python examples/10_prompt_chaining_demo.py
```

å¯é€‰åœºæ™¯ï¼š
- ğŸ“„ **æ–‡æ¡£ç”Ÿæˆé“¾** - è‡ªåŠ¨ç”ŸæˆæŠ€æœ¯æ–‡æ¡£
- ğŸ” **ä»£ç å®¡æŸ¥é“¾** - ç³»ç»ŸåŒ–ä»£ç å®¡æŸ¥
- ğŸ”¬ **ç ”ç©¶è§„åˆ’é“¾** - ç ”ç©¶é—®é¢˜åˆ°è®¡åˆ’
- ğŸ“– **æ•…äº‹åˆ›ä½œé“¾** - åˆ›æ„å†™ä½œå·¥ä½œæµ
- ğŸ’¡ **äº§å“åˆ†æé“¾** - äº§å“éœ€æ±‚åˆ†æ

### 3. Web ç•Œé¢ä½“éªŒ

```bash
# å¯åŠ¨ Web æœåŠ¡
python run_web.py

# æµè§ˆå™¨è®¿é—®
open http://localhost:8001
```

## ğŸ¯ ä»€ä¹ˆæ˜¯ Prompt Chainingï¼Ÿ

**Prompt Chainingï¼ˆæç¤ºé“¾ï¼‰** æ˜¯ä¸€ç§å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªç®€å•æ­¥éª¤çš„ AI è®¾è®¡æ¨¡å¼ã€‚

### æ ¸å¿ƒç†å¿µ

```
å¤æ‚ä»»åŠ¡ = æ­¥éª¤1 â†’ æ­¥éª¤2 â†’ æ­¥éª¤3 â†’ ... â†’ æœ€ç»ˆç»“æœ
```

- æ¯ä¸ªæ­¥éª¤ä¸“æ³¨äºä¸€ä¸ªå…·ä½“ç›®æ ‡
- å‰ä¸€æ­¥çš„è¾“å‡ºæ˜¯ä¸‹ä¸€æ­¥çš„è¾“å…¥
- æ¨¡å—åŒ–ã€å¯æ§ã€é«˜è´¨é‡

### ä¸ºä»€ä¹ˆä½¿ç”¨ Prompt Chainingï¼Ÿ

| ä¼ ç»Ÿæ–¹å¼ | Prompt Chaining |
|---------|----------------|
| âŒ ä¸€ä¸ªå¤æ‚æç¤ºè¯ | âœ… å¤šä¸ªç®€å•æç¤ºè¯ |
| âŒ è¾“å‡ºè´¨é‡ä¸ç¨³å®š | âœ… æ¯æ­¥éƒ½å¯ä¼˜åŒ– |
| âŒ éš¾ä»¥è°ƒè¯•å’Œæ”¹è¿› | âœ… æ¸…æ™°çš„æ­¥éª¤è¿½è¸ª |
| âŒ å‡ºé”™å°±è¦é‡æ¥ | âœ… å¯ä»å¤±è´¥æ­¥éª¤ç»§ç»­ |

## ğŸ“š ä½¿ç”¨ç¤ºä¾‹

### Python ä»£ç ç¤ºä¾‹

```python
from src.shuyixiao_agent.gitee_ai_client import GiteeAIClient
from src.shuyixiao_agent.agents.prompt_chaining_agent import (
    PromptChainingAgent,
    ChainStep,
    DocumentGenerationChain
)

# 1. åˆå§‹åŒ–
llm_client = GiteeAIClient()
agent = PromptChainingAgent(llm_client, verbose=True)

# 2. ä½¿ç”¨é¢„å®šä¹‰çš„é“¾
agent.create_chain("doc_gen", DocumentGenerationChain.get_steps())
result = agent.run_chain("doc_gen", "Python å¼‚æ­¥ç¼–ç¨‹å…¥é—¨")

# 3. æŸ¥çœ‹ç»“æœ
if result.success:
    print(result.final_output)  # ç”Ÿæˆçš„æ–‡æ¡£
    print(f"è€—æ—¶: {result.execution_time:.2f}ç§’")
    
    # æŸ¥çœ‹æ¯ä¸ªæ­¥éª¤çš„è¾“å‡º
    for step in result.intermediate_results:
        print(f"\næ­¥éª¤ {step['step']}: {step['name']}")
```

### è‡ªå®šä¹‰æç¤ºé“¾

```python
# å®šä¹‰ä½ è‡ªå·±çš„æç¤ºé“¾
steps = [
    ChainStep(
        name="ç†è§£éœ€æ±‚",
        description="æ·±å…¥ç†è§£ç”¨æˆ·éœ€æ±‚",
        prompt_template="è¯·åˆ†æä»¥ä¸‹éœ€æ±‚å¹¶æå–å…³é”®è¦ç‚¹ï¼š{input}"
    ),
    ChainStep(
        name="è®¾è®¡æ–¹æ¡ˆ",
        description="åŸºäºéœ€æ±‚è®¾è®¡è§£å†³æ–¹æ¡ˆ",
        prompt_template="åŸºäºä»¥ä¸‹éœ€æ±‚åˆ†æï¼Œè®¾è®¡è¯¦ç»†çš„è§£å†³æ–¹æ¡ˆï¼š{input}"
    ),
    ChainStep(
        name="å®æ–½è®¡åˆ’",
        description="åˆ¶å®šå…·ä½“çš„å®æ–½æ­¥éª¤",
        prompt_template="ä¸ºä»¥ä¸‹æ–¹æ¡ˆåˆ¶å®šè¯¦ç»†çš„å®æ–½è®¡åˆ’ï¼š{input}"
    )
]

# åˆ›å»ºå¹¶è¿è¡Œ
agent.create_chain("custom", steps)
result = agent.run_chain("custom", "æˆ‘éœ€è¦ä¸€ä¸ªä»»åŠ¡ç®¡ç†ç³»ç»Ÿ")
```

## ğŸ› ï¸ API ä½¿ç”¨

### è·å–å¯ç”¨é“¾ç±»å‹

```bash
curl http://localhost:8001/api/prompt-chaining/types
```

### æ‰§è¡Œæç¤ºé“¾

```bash
curl -X POST http://localhost:8001/api/prompt-chaining/run \
  -H "Content-Type: application/json" \
  -d '{
    "input_text": "Python è£…é¥°å™¨è¯¦è§£",
    "chain_type": "document_gen",
    "save_result": true
  }'
```

### æµå¼æ‰§è¡Œï¼ˆå®æ—¶æŸ¥çœ‹è¿›åº¦ï¼‰

```bash
curl -X POST http://localhost:8001/api/prompt-chaining/run/stream \
  -H "Content-Type: application/json" \
  -d '{
    "input_text": "åˆ†æè¿™æ®µä»£ç ...",
    "chain_type": "code_review",
    "save_result": true
  }'
```

## ğŸ¨ é¢„å®šä¹‰çš„æç¤ºé“¾åœºæ™¯

### 1. æ–‡æ¡£ç”Ÿæˆé“¾ (document_gen)

**ç”¨é€”**: è‡ªåŠ¨ç”Ÿæˆä¸“ä¸šçš„æŠ€æœ¯æ–‡æ¡£

**æ­¥éª¤**:
1. ç”Ÿæˆå¤§çº² - æ„å»ºæ–‡æ¡£ç»“æ„
2. æ’°å†™å†…å®¹ - å¡«å……è¯¦ç»†å†…å®¹
3. æ·»åŠ ç¤ºä¾‹ - æ’å…¥ä»£ç å’Œæ¡ˆä¾‹
4. ä¼˜åŒ–æ¶¦è‰² - æœ€ç»ˆä¼˜åŒ–

**é€‚åˆ**: æŠ€æœ¯æ–‡æ¡£ã€æ•™ç¨‹ã€APIæ–‡æ¡£

### 2. ä»£ç å®¡æŸ¥é“¾ (code_review)

**ç”¨é€”**: ç³»ç»ŸåŒ–çš„ä»£ç å®¡æŸ¥æµç¨‹

**æ­¥éª¤**:
1. ç†è§£ä»£ç  - åˆ†æåŠŸèƒ½å’Œç»“æ„
2. æ£€æŸ¥é—®é¢˜ - è¯†åˆ« bugã€æ€§èƒ½ã€å®‰å…¨é—®é¢˜
3. æå‡ºå»ºè®® - å…·ä½“æ”¹è¿›æ–¹æ¡ˆ
4. ç”ŸæˆæŠ¥å‘Š - å®Œæ•´å®¡æŸ¥æŠ¥å‘Š

**é€‚åˆ**: ä»£ç  Reviewã€è´¨é‡è¯„ä¼°

### 3. ç ”ç©¶è§„åˆ’é“¾ (research)

**ç”¨é€”**: å°†ç ”ç©¶é—®é¢˜è½¬åŒ–ä¸ºç³»ç»ŸåŒ–è®¡åˆ’

**æ­¥éª¤**:
1. é—®é¢˜åˆ†æ - æ·±å…¥åˆ†æç ”ç©¶é—®é¢˜
2. æ–‡çŒ®ç»¼è¿° - è§„åˆ’è°ƒç ”æ–¹å‘
3. ç ”ç©¶æ–¹æ³• - è®¾è®¡æ–¹æ³•å’Œå®éªŒ
4. æ—¶é—´è§„åˆ’ - åˆ¶å®šæ—¶é—´çº¿

**é€‚åˆ**: å­¦æœ¯ç ”ç©¶ã€æŠ€æœ¯è°ƒç ”ã€å¸‚åœºåˆ†æ

### 4. æ•…äº‹åˆ›ä½œé“¾ (story)

**ç”¨é€”**: åˆ›æ„å†™ä½œå·¥ä½œæµ

**æ­¥éª¤**:
1. æ„æ€æƒ…èŠ‚ - è®¾è®¡æ•…äº‹æ¡†æ¶
2. è§’è‰²å¡‘é€  - æ·±åŒ–è§’è‰²è®¾å®š
3. æ’°å†™åˆç¨¿ - å®Œæˆæ•…äº‹åˆç¨¿
4. æ¶¦è‰²å®Œå–„ - ä¼˜åŒ–è¯­è¨€è¡¨è¾¾

**é€‚åˆ**: åˆ›æ„å†™ä½œã€å‰§æœ¬åˆ›ä½œã€è¥é”€å†…å®¹

### 5. äº§å“åˆ†æé“¾ (product)

**ç”¨é€”**: ç³»ç»ŸåŒ–çš„äº§å“éœ€æ±‚åˆ†æ

**æ­¥éª¤**:
1. éœ€æ±‚ç†è§£ - åˆ†æç”¨æˆ·ç—›ç‚¹
2. åŠŸèƒ½è®¾è®¡ - è§„åˆ’äº§å“åŠŸèƒ½
3. æŠ€æœ¯æ–¹æ¡ˆ - æå‡ºæŠ€æœ¯å®ç°
4. å®æ–½è®¡åˆ’ - åˆ¶å®šé¡¹ç›®è®¡åˆ’

**é€‚åˆ**: äº§å“è§„åˆ’ã€éœ€æ±‚åˆ†æã€é¡¹ç›®ç­–åˆ’

## ğŸ“– å®Œæ•´æ–‡æ¡£

è¯¦ç»†ä½¿ç”¨æŒ‡å—è¯·æŸ¥çœ‹: [docs/prompt_chaining_guide.md](docs/prompt_chaining_guide.md)

åŒ…å«ï¼š
- âœ… è¯¦ç»†çš„ä½¿ç”¨æ•™ç¨‹
- âœ… æœ€ä½³å®è·µå»ºè®®
- âœ… å®é™…åº”ç”¨æ¡ˆä¾‹
- âœ… é«˜çº§åŠŸèƒ½è¯´æ˜
- âœ… å¸¸è§é—®é¢˜è§£ç­”

## ğŸ“ å­¦ä¹ èµ„æº

- **è®¾è®¡æ¨¡å¼åŸç†**: [Agentic Design Patterns - Prompt Chaining](https://github.com/ginobefun/agentic-design-patterns-cn/blob/main/07-Chapter-01-Prompt-Chaining.md)
- **ç¤ºä¾‹ä»£ç **: 
  - `examples/11_prompt_chaining_simple.py` - 3ä¸ªç®€å•ç¤ºä¾‹
  - `examples/10_prompt_chaining_demo.py` - 5ä¸ªå®Œæ•´åœºæ™¯
- **æ ¸å¿ƒå®ç°**: `src/shuyixiao_agent/agents/prompt_chaining_agent.py`

## ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯

### å†…å®¹åˆ›ä½œ
- åšå®¢æ–‡ç« ç”Ÿæˆ
- æŠ€æœ¯æ–‡æ¡£æ’°å†™
- è¥é”€æ–‡æ¡ˆåˆ›ä½œ

### ä»£ç å¼€å‘
- ä»£ç å®¡æŸ¥å’Œæ”¹è¿›
- API æ–‡æ¡£ç”Ÿæˆ
- æµ‹è¯•ç”¨ä¾‹è®¾è®¡

### ç ”ç©¶åˆ†æ
- ç ”ç©¶è®¡åˆ’åˆ¶å®š
- æ–‡çŒ®ç»¼è¿°ç”Ÿæˆ
- æ•°æ®åˆ†ææŠ¥å‘Š

### äº§å“è®¾è®¡
- éœ€æ±‚åˆ†æ
- åŠŸèƒ½è§„åˆ’
- æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡

## ğŸš€ å¼€å§‹ä½¿ç”¨

é€‰æ‹©æœ€é€‚åˆä½ çš„æ–¹å¼ï¼š

```bash
# æ–¹å¼1: å¿«é€Ÿä½“éªŒ (æ¨èæ–°æ‰‹)
python examples/11_prompt_chaining_simple.py

# æ–¹å¼2: å®Œæ•´åŠŸèƒ½
python examples/10_prompt_chaining_demo.py

# æ–¹å¼3: Web ç•Œé¢
python run_web.py
```

## ğŸ¤ åé¦ˆå’Œè´¡çŒ®

é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Ÿæ¬¢è¿ï¼š
- æäº¤ Issue
- åˆ›å»º Pull Request
- åˆ†äº«ä½ çš„ä½¿ç”¨æ¡ˆä¾‹

---

**äº«å— Prompt Chaining çš„å¼ºå¤§èƒ½åŠ›ï¼** ğŸ‰

